# 🧪 TEST_API.md

## 概要

このドキュメントでは、Express API に対する **ユニットテスト / 結合テスト** の設計方針と、**正常系・異常系** のテストケースを記述します。  
また、**OECD の品質観点**（正確性・効率性など）を意識した網羅的なテストを目指します。

---

## 🧩 テスト分類と目的

| 分類           | 対象                                | ツール              | 目的                                     |
|----------------|-------------------------------------|---------------------|------------------------------------------|
| ユニットテスト | 単体ロジック（関数・検証処理など） | Vitest              | バリデーションや個別関数の確認           |
| 結合テスト     | ルーター・DB連携API                 | Supertest + Vitest  | APIリクエスト～レスポンスの確認         |

---

## ✅ OECD品質観点に基づく方針

| OECD品質軸               | テスト方針例                                                                 |
|--------------------------|------------------------------------------------------------------------------|
| 正確性（Accuracy）       | 入力に対して期待される値が正しく返されるか（例：カテゴリ作成時のレスポンス検証） |
| 完全性（Completeness）   | 必須項目が不足している場合のバリデーションエラーが適切に処理されるか             |
| 一貫性（Consistency）     | 同じ入力に対して常に同じレスポンスが返るか（冪等性の保証）                     |
| 耐障害性（Robustness）    | 不正な入力やトークンエラー時に、サーバーがクラッシュせず適切なステータスを返すか |
| 効率性（Efficiency）     | レスポンスタイムが著しく遅延しないこと（※対象外なら記載のみ）                 |

---

## 🔍 正常系テストケース例

### `/api/auth/verify`

- 正常なトークンを送信すると `200` と `UID` を返す  
- `admin: true` クレーム付きユーザーでアクセスできる

### `/api/admin/categories`

- カテゴリを正しく `POST` すると `201` が返る  
- DB に保存された内容とレスポンスが一致する

---

## ❌ 異常系テストケース例

### `/api/auth/verify`

- トークン未送信 → `400 Bad Request`  
- 無効なトークン → `401 Unauthorized`  
- `admin: false` のユーザー → `403 Forbidden`

### `/api/admin/categories`

- 名前が空欄 → `400 Bad Request`  
- 重複カテゴリ名（ユニーク制約） → `409 Conflict` または `200`（仕様による）  
- 未認証でのアクセス → `401 Unauthorized`

---

## 🔧 使用技術・ライブラリ

- [`vitest`](https://vitest.dev/)：ユニット・結合テストフレームワーク  
- [`supertest`](https://github.com/visionmedia/supertest)：Express API のリクエストテスト  
- [`msw`](https://mswjs.io/)（必要に応じて）：モックAPIの定義・テスト用に導入可能

---


